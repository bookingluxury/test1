<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Đăng Nhập</title>
    <style>
      body {
        background: radial-gradient(
          circle at top,
          #ff9a9e,
          #ff758c,
          #ff7eb3,
          #fad0c4
        );
        background-size: 200% 200%;
        animation: gradientShift 10s ease infinite;
        color: white;
        font-family: "Poppins", sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        flex-direction: column;
      }
      @keyframes gradientShift {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      /* Hiệu ứng nhấp nháy */
      @keyframes sparkle {
        0%,
        100% {
          transform: scale(1);
          opacity: 0.5;
          clip-path: circle(50%); /* Ban đầu là hình tròn */
        }
        50% {
          transform: scale(1.5);
          opacity: 1;
          clip-path: polygon(
            50% 0%,
            61% 35%,
            98% 35%,
            68% 57%,
            79% 91%,
            50% 70%,
            21% 91%,
            32% 57%,
            2% 35%,
            39% 35%
          );
          /* Chuyển thành ngôi sao 5 cánh khi lóe sáng */
        }
      }

      .star {
        position: absolute;
        width: 7px;
        height: 7px;
        background: white;
        border-radius: 50%;
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
        animation: sparkle infinite ease-in-out;
        opacity: 0.5;
        transition: top 3s ease, left 3s ease; /* Di chuyển mượt mà */
      }
      /* Logo mới nằm trên cùng */
      .logo-top {
        position: fixed;
        top: 5px;
        left: 50%;
        transform: translateX(-50%);
        width: 350px; /* Tăng kích thước để rõ hơn */
        height: 105px;
        background: url("https://i.ibb.co/DgYWjtjM/logo-490c306a.png") no-repeat
          center/contain;
        background-size: cover; /* Đảm bảo hình ảnh vừa với khung */
        z-index: 1001;
        transition: transform 0.3s ease;
        padding: 5px;
        backdrop-filter: blur(5px); /* Hiệu ứng mờ nền */
      }

      /* Hiệu ứng khi hover vào logo */
      .logo-top:hover {
        transform: translateX(-50%) scale(1.1); /* Phóng to nhẹ khi hover */
      }

      .logo {
        width: 100px;
        height: 100px;
        border-radius: 10%;
        background: url("https://i.ibb.co/GQ75nVT5/Untitled-design-2025-02-06-T181058-158.png")
          no-repeat center/cover;
        margin-bottom: 20px;
      }

      .form-container {
        padding: 20px;
        border-radius: 15px;
        text-align: center;
        width: 70%;
      }

      h2 {
        margin-bottom: 30px;
        color: #0a0a0a;
      }

      input[type="text"],
      input[type="password"],
      input[type="tel"] {
        width: 95%;
        padding: 10px;
        margin: 10px 0;
        border: 1px solid #ccc;
        border-radius: 15px;
        font-size: 1rem;
      }

      button {
        width: 100%;
        padding: 10px;
        background-color: #000000;
        color: #fff;
        border: none;
        border-radius: 15px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
        transition: background-color 0.3s;
      }

      button:hover {
        background-color: #d81b60;
      }

      .form-links {
        margin-top: 10px;
        font-size: 14px;
      }

      .form-links a {
        color: #000000;
        margin: 0 5px;
      }

      .form-links a:hover {
        text-decoration: underline;
      }

      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="logo-top"></div>
    <div class="logo"></div>
    <div class="stars" style="top: 50px; left: 100px"></div>
    <div class="stars" style="top: 120px; left: 300px"></div>
    <div class="stars" style="top: 200px; left: 500px"></div>
    <div class="stars" style="top: 350px; left: 700px"></div>
    <div class="stars" style="top: 450px; left: 150px"></div>
    <div class="stars" style="top: 600px; left: 400px"></div>
    <div class="stars" style="top: 50px; left: 800px"></div>
    <div class="stars" style="top: 300px; left: 900px"></div>

    <!-- Form đăng nhập -->
    <div id="login-form" class="form-container">
      <h2>Đăng nhập</h2>
      <input type="text" id="login-username" placeholder="Tên người dùng" />
      <input type="password" id="login-password" placeholder="Mật khẩu" />
      <button id="login-btn">Đăng nhập</button>
      <!-- Thêm ID cho nút đăng nhập -->
      <div class="form-links">
        <a href="#" id="show-forgot">Quên mật khẩu?</a>
        <span>|</span>
        <a href="#" id="show-register">Đăng ký ngay</a>
      </div>
    </div>

    <!-- Form đăng ký -->
    <div id="register-form" class="form-container hidden">
      <h2>Đăng ký</h2>
      <input type="text" id="reg-username" placeholder="Tên người dùng" />
      <input type="tel" id="reg-phone" placeholder="Số điện thoại" />
      <input type="password" id="reg-password" placeholder="Mật khẩu" />
      <input type="password" id="reg-confirm" placeholder="Nhập lại mật khẩu" />
      <button id="register-btn">Đăng ký</button>
      <!-- ID cho nút đăng ký -->
      <div class="form-links">
        <a href="#" id="show-login-from-register">Đã có tài khoản? Đăng nhập</a>
      </div>
    </div>

    <!-- Form quên mật khẩu -->
    <div id="forgot-form" class="form-container hidden">
      <h2>Quên mật khẩu</h2>
      <input type="text" id="forgot-username" placeholder="Tên người dùng" />
      <input type="tel" id="forgot-phone" placeholder="Số điện thoại" />
      <button id="forgot-btn">Gửi yêu cầu</button>
      <!-- ID cho nút gửi yêu cầu -->
      <div class="form-links">
        <a href="#" id="show-login-from-forgot">Trở lại đăng nhập</a>
      </div>
    </div>

    <!-- JavaScript chuyển đổi giữa các form -->
    <script>
      const numStars = 8; // Số lượng sao
      const body = document.body;

      const stars = [];

      // Tạo các ngôi sao với vị trí ban đầu ngẫu nhiên
      for (let i = 0; i < numStars; i++) {
        const star = document.createElement("div");
        star.classList.add("star");

        const randomX = Math.random() * window.innerWidth;
        const randomY = Math.random() * window.innerHeight;

        const randomDuration = Math.random() * 5 + 3; // Thời gian nhấp nháy
        const randomDelay = Math.random() * 5; // Độ trễ nhấp nháy

        star.style.top = `${randomY}px`;
        star.style.left = `${randomX}px`;
        star.style.animationDuration = `${randomDuration}s`;
        star.style.animationDelay = `${randomDelay}s`;

        body.appendChild(star);
        stars.push(star); // Lưu ngôi sao để di chuyển sau
      }

      // Hàm để di chuyển các ngôi sao đến vị trí mới sau mỗi 5 giây
      function moveStars() {
        stars.forEach((star) => {
          const newX = Math.random() * window.innerWidth;
          const newY = Math.random() * window.innerHeight;

          star.style.top = `${newY}px`;
          star.style.left = `${newX}px`;
        });
      }

      // Tự động di chuyển sao sau mỗi 5 giây
      setInterval(moveStars, 5000);

      // Lấy các phần tử form
      const loginForm = document.getElementById("login-form");
      const registerForm = document.getElementById("register-form");
      const forgotForm = document.getElementById("forgot-form");

      // Chuyển đổi form
      document
        .getElementById("show-register")
        .addEventListener("click", (e) => {
          e.preventDefault();
          loginForm.classList.add("hidden");
          registerForm.classList.remove("hidden");
          forgotForm.classList.add("hidden");
        });

      document.getElementById("show-forgot").addEventListener("click", (e) => {
        e.preventDefault();
        loginForm.classList.add("hidden");
        registerForm.classList.add("hidden");
        forgotForm.classList.remove("hidden");
      });

      document
        .getElementById("show-login-from-register")
        .addEventListener("click", (e) => {
          e.preventDefault();
          loginForm.classList.remove("hidden");
          registerForm.classList.add("hidden");
          forgotForm.classList.add("hidden");
        });

      document
        .getElementById("show-login-from-forgot")
        .addEventListener("click", (e) => {
          e.preventDefault();
          loginForm.classList.remove("hidden");
          registerForm.classList.add("hidden");
          forgotForm.classList.add("hidden");
        });

      // Xử lý đăng nhập
      document
        .getElementById("login-btn")
        .addEventListener("click", async (e) => {
          e.preventDefault();
          const username = document
            .getElementById("login-username")
            .value.trim();
          const password = document
            .getElementById("login-password")
            .value.trim();

          if (!username || !password) {
            alert("⚠️ Vui lòng nhập đầy đủ thông tin");
            return;
          }

          try {
            const response = await fetch("/api/login", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ username, password }),
            });

            const data = await response.json();

            if (response.ok) {
              alert("🎉 Đăng nhập thành công!");
              // Chuyển hướng sang trang dashboard.html sau khi đăng nhập thành công
              window.location.href = "/dashboard.html";
            } else {
              alert("❌ Lỗi: " + (data.message || "Đăng nhập thất bại"));
            }
          } catch (error) {
            console.error("Lỗi khi đăng nhập:", error);
            alert("🚨 Lỗi kết nối máy chủ. Vui lòng thử lại sau.");
          }
        });

      // Xử lý đăng ký
      document
        .getElementById("register-btn")
        .addEventListener("click", async (e) => {
          e.preventDefault();

          const username = document.getElementById("reg-username").value.trim();
          const phone = document.getElementById("reg-phone").value.trim();
          const password = document.getElementById("reg-password").value.trim();
          const confirmPassword = document
            .getElementById("reg-confirm")
            .value.trim();

          if (!username || !phone || !password || !confirmPassword) {
            alert("⚠️ Vui lòng nhập đầy đủ thông tin");
            return;
          }

          if (password !== confirmPassword) {
            alert("❌ Mật khẩu không khớp");
            return;
          }

          try {
            const response = await fetch("/api/register", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ username, phone, password }),
            });

            const data = await response.json();

            if (response.ok) {
              alert("🎉 Đăng ký thành công! Vui lòng đăng nhập.");
              document.getElementById("login-form").classList.remove("hidden");
              document.getElementById("register-form").classList.add("hidden");
            } else {
              alert("❌ Lỗi: " + (data.message || "Đăng ký thất bại"));
            }
          } catch (error) {
            console.error("Lỗi khi đăng ký:", error);
            alert("🚨 Lỗi kết nối máy chủ. Vui lòng thử lại sau.");
          }
        });

      // Xử lý quên mật khẩu
      document
        .getElementById("forgot-btn")
        .addEventListener("click", async (e) => {
          e.preventDefault();
          const username = document
            .getElementById("forgot-username")
            .value.trim();
          const phone = document.getElementById("forgot-phone").value.trim();

          if (!username || !phone) {
            alert("⚠️ Vui lòng nhập tên người dùng và số điện thoại");
            return;
          }

          try {
            const response = await fetch("/api/forgot-password", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ username, phone }),
            });

            const data = await response.json();

            if (response.ok) {
              alert(
                "✅ Yêu cầu đặt lại mật khẩu đã được gửi. Vui lòng kiểm tra điện thoại."
              );
            } else {
              alert(
                "❌ Lỗi: " +
                  (data.message || "Không tìm thấy thông tin người dùng")
              );
            }
          } catch (error) {
            console.error("Lỗi khi gửi yêu cầu quên mật khẩu:", error);
            alert("🚨 Lỗi kết nối máy chủ. Vui lòng thử lại sau.");
          }
        });
    </script>
  </body>
</html>
